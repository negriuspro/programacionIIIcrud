<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagos - ProgramacionIII CRUD</title>
    <link rel="stylesheet" href="/styles/payment.css">
</head>

<body>
    <nav class="navbar">
        <div class="nav-brand">ProgramacionIII CRUD</div>
        <div class="nav-links">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/profile.html">Perfil</a>
            <a href="/payment.html" class="active">Pagos</a>
            <a href="/login.html">Salir</a>
        </div>
    </nav>

    <div class="payment-container">
        <h1>Procesar Pago</h1>

        <div class="payment-card">
            <form id="paymentForm">
                <div class="form-group">
                    <label for="orderId">ID de Orden</label>
                    <input type="number" id="orderId" name="orderId" required>
                </div>
                <div class="form-group">
                    <label for="amount">Monto</label>
                    <input type="number" id="amount" name="amount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="paymentMethod">Método de Pago</label>
                    <select id="paymentMethod" name="paymentMethod" required>
                        <option value="">Seleccionar...</option>
                        <option value="credit_card">Tarjeta de Crédito</option>
                        <option value="debit_card">Tarjeta de Débito</option>
                        <option value="paypal">PayPal</option>
                        <option value="cash">Efectivo</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Procesar Pago</button>
            </form>
        </div>

        <div class="payments-list">
            <h2>Historial de Pagos</h2>
            <div id="paymentsList">
                <p>No hay pagos registrados</p>
            </div>
        </div>
    </div>

    <script>
        async function loadPayments() {
            try {
                const response = await fetch('/api/payment');
                const payments = await response.json();

                const listDiv = document.getElementById('paymentsList');
                if (payments.length === 0) {
                    listDiv.innerHTML = '<p>No hay pagos registrados</p>';
                } else {
                    listDiv.innerHTML = payments.map(p => `
                        <div class="payment-item">
                            <p><strong>ID:</strong> ${p.id}</p>
                            <p><strong>Orden:</strong> ${p.orderId}</p>
                            <p><strong>Monto:</strong> $${p.amount}</p>
                            <p><strong>Método:</strong> ${p.paymentMethod}</p>
                            <p><strong>Estado:</strong> ${p.status}</p>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading payments:', error);
            }
        }

        document.getElementById('paymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const paymentData = {
                orderId: parseInt(document.getElementById('orderId').value),
                amount: parseFloat(document.getElementById('amount').value),
                paymentMethod: document.getElementById('paymentMethod').value
            };

            try {
                const response = await fetch('/api/payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(paymentData)
                });

                if (response.ok) {
                    alert('Pago procesado exitosamente');
                    document.getElementById('paymentForm').reset();
                    loadPayments();
                } else {
                    alert('Error al procesar pago');
                }
            } catch (error) {
                alert('Error de conexión');
            }
        });

        loadPayments();
    </script>
</body>

</html>